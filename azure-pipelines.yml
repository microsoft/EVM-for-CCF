# https://aka.ms/yaml

trigger:
  batch: true
  branches:
    include:
      - "master"

pr:
  autoCancel: true
  branches:
    include:
      - master

jobs:
  - job: Build and Test SGX
    pool: Ubuntu-1804-DC4s
    container: ccfciteam/ccf-ci-18.04-oe-0.7.0-sgx:latest
    options: --publish-all --device /dev/sgx:/dev/sgx

    steps:
    - checkout: self
      clean: true
      submodules: true

    - script: mkdir build
      displayName: 'Create build directory'

    - script: cmake .. -GNinja -L
      displayName: CMake
      workingDirectory: build

    - script: ninja
      displayName: Build
      workingDirectory: build

    - script: ./tests.sh -VV
      displayName: Tests
      workingDirectory: build
